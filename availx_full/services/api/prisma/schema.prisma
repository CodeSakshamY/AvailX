generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
model User {
  id           String    @id @default(uuid())
  name         String
  email        String?   @unique
  phone        String    @unique
  role         UserRole  @default(CUSTOMER)
  passwordHash String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  providers    Provider[] 
  bookings     Booking[] @relation("userBookings")
  reviews      Review[]
}
model Provider {
  id               String    @id @default(uuid())
  userId           String
  name             String
  category         String
  description      String?
  lat              Float
  lon              Float
  address          String?
  aadhaarVerified  Boolean   @default(false)
  verificationTier Int       @default(0)
  reputationScore  Float     @default(50.0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  user             User      @relation(fields: [userId], references: [id])
  listings         Listing[]
  bookings         Booking[] 
  reviews          Review[]
}
model Listing {
  id          String   @id @default(uuid())
  providerId  String
  title       String
  price       Float
  durationMin Int
  slotType    SlotType
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  provider    Provider @relation(fields: [providerId], references: [id])
  availabilities Availability[]
}
model Availability {
  id         String   @id @default(uuid())
  listingId  String
  date       DateTime
  startTime  DateTime
  endTime    DateTime
  capacity   Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  listing    Listing  @relation(fields: [listingId], references: [id])
}
model Booking {
  id            String   @id @default(uuid())
  userId        String
  providerId    String
  listingId     String
  status        BookingStatus @default(PENDING)
  scheduledFor  DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation("userBookings", fields: [userId], references: [id])
  provider      Provider @relation(fields: [providerId], references: [id])
  listing       Listing  @relation(fields: [listingId], references: [id])
}
model Review {
  id         String   @id @default(uuid())
  bookingId  String
  userId     String
  providerId String
  rating     Int
  comment    String?
  createdAt  DateTime @default(now())
  booking    Booking  @relation(fields: [bookingId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
  provider   Provider @relation(fields: [providerId], references: [id])
}
enum UserRole {
  CUSTOMER
  PROVIDER
  ADMIN
}
enum SlotType {
  INSTANT
  SCHEDULED
  QUEUE
}
enum BookingStatus {
  PENDING
  ACCEPTED
  REJECTED
  CANCELLED
  COMPLETED
}
